<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customizable Button & Form</title>
    <link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet">
    <script src="https://unpkg.com/grapesjs"></script>
    <script src="https://unpkg.com/grapesjs-tailwind"></script>
</head>

<style>
    body, html {
        margin: 0;
        height: 100%;
    }

    /* Adjust block preview in block manager */
    .gjs-block {
        padding: 0 !important;
        width: 100% !important;
        min-height: auto !important;
    }

    .gjs-block svg {
        width: 100%;
    }
</style>

<body>
    <div id="gjs"></div>
    <script>
        // Initialize GrapesJS
        const editor = grapesjs.init({
            container: '#gjs',
            height: '100%',
            fromElement: true,
            storageManager: false,
            plugins: ['grapesjs-tailwind'],
            canvas: {
                styles: ['https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css'],
            },
        });

        // Add a customizable button block with a live preview in the block manager
        editor.BlockManager.add("tailwind-button", {
            label: `
                <div class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                    Customizable Button
                </div>
            `,
            content: `
                <a href="#" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                    Customizable Button
                </a>
            `,
            attributes: { class: 'gjs-fonts gjs-f-button' },
            category: 'Basic',
        });

        // Add the ability to customize the button's attributes
        editor.DomComponents.addType('custom-button', {
            isComponent: el => el.tagName === 'A' && el.classList.contains('custom-button'),
            model: {
                defaults: {
                    tagName: 'a',
                    droppable: false,
                    attributes: { href: '#' },
                    classes: [
                        'text-white', 'bg-blue-700', 'hover:bg-blue-800', 'focus:ring-4', 'focus:ring-blue-300',
                        'font-medium', 'rounded-lg', 'text-sm', 'px-5', 'py-2.5', 'me-2', 'mb-2',
                        'dark:bg-blue-600', 'dark:hover:bg-blue-700', 'focus:outline-none', 'dark:focus:ring-blue-800'
                    ],
                    traits: [
                        {
                            type: 'text',
                            label: 'Text',
                            name: 'innerHTML',
                            placeholder: 'Button Text',
                        },
                        {
                            type: 'href',
                            label: 'URL',
                            name: 'href',
                        },
                        {
                            type: 'class_select',
                            options: [
                                { value: 'bg-blue-700', name: 'Blue' },
                                { value: 'bg-red-700', name: 'Red' },
                                { value: 'bg-green-700', name: 'Green' },
                                { value: 'bg-yellow-700', name: 'Yellow' },
                            ],
                            label: 'Background Color',
                            name: 'class',
                        },
                        {
                            type: 'select',
                            label: 'Font Size',
                            name: 'font-size',
                            options: [
                                { value: 'text-sm', name: 'Small' },
                                { value: 'text-md', name: 'Medium' },
                                { value: 'text-lg', name: 'Large' }
                            ],
                        },
                    ],
                },
            },
        });

        // Add the custom contact form block
        editor.BlockManager.add("Form", {
            label: "Custom Contact Form",
            content: `
                <div class="p-4 mx-auto max-w-xl bg-white font-[sans-serif] custom-contact-form">
                    <h1 class="text-3xl text-gray-800 font-extrabold text-center">Contact us</h1>
                    <form class="mt-8 space-y-4">
                        <input type='text' placeholder='Name'
                            class="w-full rounded-md py-3 px-4 text-gray-800 bg-gray-100 focus:bg-transparent text-sm outline-blue-500" />
                        <input type='email' placeholder='Email'
                            class="w-full rounded-md py-3 px-4 text-gray-800 bg-gray-100 focus:bg-transparent text-sm outline-blue-500" />
                        <input type='text' placeholder='Subject'
                            class="w-full rounded-md py-3 px-4 text-gray-800 bg-gray-100 focus:bg-transparent text-sm outline-blue-500" />
                        <textarea placeholder='Message' rows="6"
                            class="w-full rounded-md px-4 text-gray-800 bg-gray-100 focus:bg-transparent text-sm pt-3 outline-blue-500"></textarea>
                        <button type='button'
                            class="text-white bg-blue-500 hover:bg-blue-600 tracking-wide rounded-md text-sm px-4 py-3 w-full">Send</button>
                    </form>
                </div>
            `,
            attributes: { class: 'gjs-fonts gjs-f-button' },
            category: 'Basic',
        });

        // Add the ability to customize the contact form's attributes
        editor.DomComponents.addType('custom-contact-form', {

            isComponent: el => el.tagName === 'FORM' && el.classList.contains('custom-contact-form'),
            model: {
                defaults: {
                    tagName: 'form',
                    traits: [
                        {
                            type: 'text',
                            label: 'Name Placeholder',
                            name: 'name-placeholder',
                        },
                        {
                            type: 'text',
                            label: 'Email Placeholder',
                            name: 'email-placeholder',
                        },
                        {
                            type: 'text',
                            label: 'Message Placeholder',
                            name: 'message-placeholder',
                        },
                    ],
                },
            },
        });

        editor.DomComponents.addType('test-component', {
    model: {
        defaults: {
            testprop: '12345',
            url: 'https://jsonplaceholder.typicode.com/posts/1'
        },
        init() {
            console.log('Local hook: model.init', this.attributes.testprop);
            fetch(this.attributes.url)
                .then(response => response.json())
                .then(commits => {
                    this.set('testprop', 'Test');
                    console.log(this.attributes.testprop);
                });
            this.listenTo(this, 'change:testprop', this.handlePropChange);
            // Here we can listen global hooks with editor.on('...')
        },
        updated(property, value, prevValue) {
            console.log('Local hook: model.updated',
                'property', property, 'value', value, 'prevValue', prevValue);
        },
        removed() {
            console.log('Local hook: model.removed');
        },
        handlePropChange() {
             let prop = this.get('testprop');
            // Here inside view it is getting the old value. of "testprop" i.e '12345' but not 
            //the new value 
            //which is being fetched from server in the init() of model.
            let comp1 = '<div>' +
                '<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Image_created_with_a_mobile_phone.png/1200px-Image_created_with_a_mobile_phone.png" />' +
                '<span title="foo">' + prop + '</span>' +  '</div>';

                const component = editor.addComponents(comp1);
            return component
        }
    },
    view: {
        init() {
            console.log('Local hook: view.init');
        },
       
    },
});

// A block for the custom component
editor.BlockManager.add('test-component', {
    label: 'Test Component',
    content: `<div data-gjs-type="test-component"></div>`,
});
    </script>
</body>

</html>
